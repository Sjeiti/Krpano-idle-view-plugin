window.krpanoplugin=function(){"use strict";function a(){c(),d()}function b(){c(!1),d()}function c(a){if(void 0===a&&(a=!0),k!==a){for(var b=a?window.addEventListener:window.removeEventListener,c=["mousemove","touchmove"],e=0;e<c.length;e++)b(c[e],d);k=a}}function d(){l&&e(!1),void 0!==g&&clearTimeout(g),g=setTimeout(function(){e()},u)}function e(a){void 0===a&&(a=!0),l!==a&&(l=a,l&&f(),window.dispatchEvent(new CustomEvent(l?E:F)))}function f(){var a=Date.now(),b=a-h,c=Math.min(Math.max(h?b/10:1,H*G),I*G);K.push(c),K.shift(),G=0;for(var d=0;J>d;d++)G+=K[d];if(G/=J,h=a,l){if(1e3>b){var e="";if(n>0){var g=n*m*(L.noise(C[0]+r*q*a,C[1])-.5)+A*B;e+="set(hlookat_moveforce,"+G*g+");"}if(o>0){var j=o*m*(L.noise(C[2]+s*q*a,C[3])-.5);z>=0&&(j-=z*x*i.get("view.vlookat")),e+="set(vlookat_moveforce,"+G*j+");"}if(p>0){var k=p*m*(L.noise(C[4]+t*q*a,C[5])-.5);y>=0&&(k-=y*w*(i.get("view.fov")-v)),e+="set(fov_moveforce,"+G*k+");"}""!==e&&i.call(e)}requestAnimFrame(f)}else i.call("set(hlookat_moveforce,0);set(vlookat_moveforce,0);set(fov_moveforce,0);"),h=null}var g,h,i=null,j=null,k=!1,l=!1,m=.1,n=1,o=1,p=1,q=1e-4,r=1,s=1,t=1,u=1,v=95,w=.002,x=.001,y=1,z=1,A=.01,B=0,C=function(a){for(var b=0;16>b;b++)a.push(999+parseInt(99999*Math.random(),10));return a}([]),D="idleViewInitialized",E="idleViewStart",F="idleViewEnd",G=1.5,H=.87,I=1/H,J=11,K=function(a){for(var b=0;J>b;b++)a.push(G);return a}([]);this.registerplugin=function(c,d,e){if(delete window.krpanoplugin,i=c,j=e,i.version<"1.0.8.14"||i.build<"2011-03-30")return void console.warn(3,"idleView plugin - too old krpano version (min. 1.0.8.14)");var f=i.get("xml").content,g=f&&f.match(/\sfov="([0-9]*)"/);g&&g.length>1&&(v=parseInt(g[1],10)),j.registerattribute("idletimeout",u,function(a){u=a},function(){return u}),j.registerattribute("forceh",n,function(a){n=a},function(){return n}),j.registerattribute("forcev",o,function(a){o=a},function(){return o}),j.registerattribute("forcez",p,function(a){p=a},function(){return p}),j.registerattribute("frequencyh",r,function(a){r=a},function(){return r}),j.registerattribute("frequencyv",s,function(a){s=a},function(){return s}),j.registerattribute("frequencyz",t,function(a){t=a},function(){return t}),j.registerattribute("attractv",z,function(a){z=a},function(){return z}),j.registerattribute("attractz",y,function(a){y=a},function(){return y}),j.registerattribute("offseth",0,function(a){B=a},function(){return B}),j.enable=a,j.disable=b,a(),j.toString=function(){return"[object krpano idle view plugin]"},window.dispatchEvent(new CustomEvent(D,{detail:j}))},this.unloadplugin=function(){c(!1),j=null,i=null},window.krpanoIdleViewPlugin={toString:function(){return"[object krpano idle view plugin]"}},window.hasOwnProperty("requestAnimFrame")||(window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}());var L=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F=.5*(Math.sqrt(3)-1),G=(3-Math.sqrt(3))/6,H=2*G-1,I=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],J=Math,K=1,L=.5,M=function(){var a,b;C=[],D=[],E=0;for(var c=0;K>c;c++)a=Math.pow(2,c),b=Math.pow(L,c),E+=b,C.push(a),D.push(b);E=1/E},N=function(a,b,c){return a[0]*b+a[1]*c},O=function(){var b,c=[];for(b=0;256>b;b++)c[b]=Math.floor(256*J.random());for(a=[],b=0;512>b;b++)a[b]=c[255&b]},P=function(b,z){return f=(b+z)*F,g=Math.floor(b+f),h=Math.floor(z+f),i=(g+h)*G,j=b-(g-i),k=z-(h-i),j>k?(l=1,m=0):(l=0,m=1),n=j-l+G,o=k-m+G,p=j+H,q=k+H,r=255&g,s=255&h,w=.5-j*j-k*k,0>w?c=0:(w*=w,t=a[r+a[s]]%12,c=w*w*N(I[t],j,k)),x=.5-n*n-o*o,0>x?d=0:(x*=x,u=a[r+l+a[s+m]]%12,d=x*x*N(I[u],n,o)),y=.5-p*p-q*q,0>y?e=0:(y*=y,v=a[r+1+a[s+1]]%12,e=y*y*N(I[v],p,q)),70*(c+d+e)};return O(),M(),{noise:function(a,c){for(z=0,b=0;K>b;b++)A=C[b],B=D[b],z+=B*P(A*a,A*c);return.5*(z*E+1)},noiseDetail:function(a,b){K=a||K,L=b||L,M()},setRng:function(a){J=a,O()},toString:function(){return"[object PerlinSimplex "+K+" "+L+"]"}}}()};